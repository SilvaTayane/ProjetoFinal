{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="card shadow-lg border-0 rounded-lg mt-5">
        <div class="card-header bg-secondary text-white">
          <h3 class="text-center font-weight-light my-4">Reserva de Espaço</h3>
        </div>
        <div class="card-body">
          <form action="{% url 'reservas' %}" method="post" class="needs-validation" novalidate>
            {% csrf_token %}
            
            <!-- Exibir erros não relacionados a campos específicos -->
            {% if form.non_field_errors %}
            <div class="alert alert-danger">
              {% for error in form.non_field_errors %}
                {{ error }}
              {% endfor %}
            </div>
            {% endif %}

            <!-- Campo Sala -->
            <div class="mb-4">
              <label for="{{ form.sala_de_reserva.id_for_label }}" class="form-label fw-bold">
                {{ form.sala_de_reserva.label }}
              </label>
              {{ form.sala_de_reserva }}
              {% if form.sala_de_reserva.errors %}
                <div class="invalid-feedback d-block">
                  {{ form.sala_de_reserva.errors.0 }}
                </div>
              {% endif %}
            </div>

            <div class="row g-3 mb-4">
              <!-- Campo Nome -->
              <div class="col-md-6">
                <label for="{{ form.nome_completo.id_for_label }}" class="form-label fw-bold">
                  {{ form.nome_completo.label }}
                </label>
                {{ form.nome_completo }}
                {% if form.nome_completo.errors %}
                  <div class="invalid-feedback d-block">
                    {{ form.nome_completo.errors.0 }}
                  </div>
                {% endif %}
              </div>

              <!-- Campo Email -->
              <div class="col-md-6">
                <label for="{{ form.email.id_for_label }}" class="form-label fw-bold">
                  {{ form.email.label }}
                </label>
                {{ form.email }}
                {% if form.email.errors %}
                  <div class="invalid-feedback d-block">
                    {{ form.email.errors.0 }}
                  </div>
                {% endif %}
              </div>
            </div>

            <div class="row g-3 mb-4">
              <!-- Campo CPF -->
              <div class="col-md-6">
                <label for="{{ form.cpf.id_for_label }}" class="form-label fw-bold">
                  {{ form.cpf.label }}
                </label>
                {{ form.cpf }}
                <small class="form-text text-muted">{{ form.cpf.help_text }}</small>
                {% if form.cpf.errors %}
                  <div class="invalid-feedback d-block">
                    {{ form.cpf.errors.0 }}
                  </div>
                {% endif %}
              </div>

              <!-- Campo Data -->
              <div class="col-md-6">
                <label for="{{ form.data_reserva.id_for_label }}" class="form-label fw-bold">
                  {{ form.data_reserva.label }}
                </label>
                {{ form.data_reserva }}
                {% if form.data_reserva.errors %}
                  <div class="invalid-feedback d-block">
                    {{ form.data_reserva.errors.0 }}
                  </div>
                {% endif %}
              </div>
            </div>

            <!-- Campos de Horário -->
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label for="{{ form.hora_entrada.id_for_label }}" class="form-label fw-bold">
                  {{ form.hora_entrada.label }}
                </label>
                {{ form.hora_entrada }}
                {% if form.hora_entrada.errors %}
                  <div class="invalid-feedback d-block">
                    {{ form.hora_entrada.errors.0 }}
                  </div>
                {% endif %}
              </div>
              <div class="col-md-6">
                <label for="{{ form.hora_saida.id_for_label }}" class="form-label fw-bold">
                  {{ form.hora_saida.label }}
                </label>
                {{ form.hora_saida }}
                {% if form.hora_saida.errors %}
                  <div class="invalid-feedback d-block">
                    {{ form.hora_saida.errors.0 }}
                  </div>
                {% endif %}
              </div>
            </div>

            <!-- Botão de Submit -->
            <div class="d-grid mt-5">
              <button type="submit" class="btn btn-secondary btn-lg py-3 fw-bold">
                <i class="fas fa-calendar-check me-2"></i> Confirmar Reserva
              </button>
            </div>
          </form>
        </div>
        <div class="card-footer text-center py-3 bg-light">
          <small class="text-muted">Dúvidas? Entre em contato: contato@coworking.com</small>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Adicione isso no final do seu template base ou antes de fechar o body -->
<script>
// Validação do frontend
(function () {
  'use strict'
  
  // Pegue todos os forms que queremos aplicar estilos de validação customizados
  var forms = document.querySelectorAll('.needs-validation')
  
  // Loop sobre eles e previna submissão
  Array.prototype.slice.call(forms)
    .forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }

        form.classList.add('was-validated')
      }, false)
    })
})()
</script>

<style>
  .card {
    border: none;
    border-radius: 15px;
    overflow: hidden;
    transition: transform 0.3s ease;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(108, 117, 125, 0.2);
  }
  
  .card-header {
    padding: 1.5rem;
    background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
  }
  
  .form-control, .form-select {
    border-radius: 10px;
    border: 2px solid #e9ecef;
    transition: all 0.3s;
  }
  
  .form-control:focus, .form-select:focus {
    border-color: #6c757d;
    box-shadow: 0 0 0 0.25rem rgba(108, 117, 125, 0.25);
  }
  
  .form-control-lg {
    font-size: 1.1rem;
  }
  
  .btn-secondary {
    background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
    border: none;
    letter-spacing: 0.5px;
    transition: all 0.3s;
  }
  
  .btn-secondary:hover {
    background: linear-gradient(135deg, #5a6268 0%, #495057 100%);
    transform: translateY(-2px);
  }
  
  .invalid-feedback {
    font-size: 0.9rem;
    color: #dc3545;
  }
  
  .form-text.text-muted {
    color: #6c757d !important;
  }
</style>
<!-- Modal de Sucesso -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="successModalLabel">
          <i class="fas fa-check-circle me-2"></i> Reserva Confirmada!
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-4">
          <i class="fas fa-check-circle text-success" style="font-size: 5rem;"></i>
        </div>
        <h4 class="text-center mb-3">Sua reserva foi realizada com sucesso!</h4>
        <p class="text-center text-muted">
          Você receberá um e-mail de confirmação com os detalhes da sua reserva.
          Caso precise de alguma alteração, entre em contato conosco.
        </p>
      </div>
      <div class="modal-footer justify-content-center bg-light">
        <button type="button" class="btn btn-success px-4 py-2 fw-bold" data-bs-dismiss="modal">
          <i class="fas fa-thumbs-up me-2"></i> Fechar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Script para mostrar o modal após envio do formulário -->
<script>
// Substitua o script principal por este:
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('.needs-validation');
  
  form.addEventListener('submit', function(event) {
    event.preventDefault();
    
    if (form.checkValidity()) {
      // Envia o formulário via AJAX
      fetch(form.action, {
        method: 'POST',
        body: new FormData(form),
        headers: {
          'X-Requested-With': 'XMLHttpRequest',
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const successModal = new bootstrap.Modal(document.getElementById('successModal'));
          successModal.show();
          form.reset();
          form.classList.remove('was-validated');
        } else {
          // Mostrar erros do servidor
          alert(data.error || 'Ocorreu um erro ao processar sua reserva.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Ocorreu um erro de conexão.');
      });
    }
    
    form.classList.add('was-validated');
  });
});
</script>

<!-- Estilo adicional para o modal -->
<style>
  .modal-content {
    border-radius: 15px;
    overflow: hidden;
    border: none;
  }
  
  .modal-header {
    padding: 1.5rem;
    background: linear-gradient(135deg,rgb(84, 87, 85) 0%,rgb(55, 56, 55) 100%);
  }
  
  .modal-title {
    font-weight: 600;
    letter-spacing: 0.5px;
  }
  
  .modal-body {
    padding: 2rem;
  }
  
  .btn-success {
    background: linear-gradient(135deg,rgb(97, 97, 97) 0%,rgb(93, 97, 94) 100%);
    border: none;
    border-radius: 10px;
    padding: 0.75rem 1.5rem;
    font-size: 1.1rem;
    transition: all 0.3s;
  }
  
  .btn-success:hover {
    background: linear-gradient(135deg,rgb(70, 71, 70) 0%,rgb(61, 65, 62) 100%);
    transform: translateY(-2px);
  }
</style>

{% endblock %}